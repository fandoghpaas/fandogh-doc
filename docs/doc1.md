---
id: doc1
title: مستندات پلتفرم فندق
sidebar_label: مستندات پلتفرم فندق
---

# فندق چیست؟

تا پیش از به وجود آمدن پلتفرم‌های نرم‌افزاری، کابران برای راه‌اندازی یک سرویس نرم‌افزاری آنلاین نیاز داشتند که یک سرور ( یا VPS ) تهیه کنند و سرویس خود را روی آن ارائه دهند.  
این روش حداکثر انعطاف‌پذیری را در اختیار شما قرار می‌دهد اما طبیعتا چالش‌هایی مثل پیکربندی صحیح، نگهداری و امنیت به عهده خود شما خواهد بود. گذشته از چالش‌های فنی و هزینه تیمی که برای مدیریت سرور‌ها باید بپردازید، برای تهیه چنین سرو‌رهایی شما باید به میزانی منابع سخت‌افزاری در نظر بگیرید که حتی در ساعات اوج فشار روی سرویس نرم‌افزاری که مصرف منابع به بیشترین حد خود می‌رسد، سرویس نرم‌افزاری بدون مشکل به کار خود ادامه دهد. این یعنی اگر ۶ ساعت در روز سرویس شما در ساعات اوج مصرف است، ۱۸ ساعت دیگر روز بخش قابل توجهی از منابع شما بلا استفاده باقی می‌ماند در حالی که هزینه آن را پرداخت کرده‌اید.

فندق یک پلتفرم برای راه‌اندازی و نگهداری سرویس‌های نرم‌افزاری است که به کابران اجازه می‌دهد به طور منعطف و مقیاس‌پذیر سرویس‌های نرم‌افزار خود را راه‌اندازی کنند و متناسب با منابعی که مصرف می‌کنند هزینه کنند.  
به طور خلاصه با استفاده از فندق شما فقط کافیست پروژه‌های خود را [داکرایز کنید](https://hackernoon.com/how-to-dockerize-any-application-b60ad00e76da) تا فندق آن‌ها را تبدیل به سرویس‌های در حال اجرا کند.

# شروع کار با فندق

## عضویت

برای استفاده از فندق شما نیاز به یک حساب کاربری دارید، شما می‌توانید از طریق [https://fandogh.cloud](https://fandogh.cloud) در فندق عضو شوید.  
در هنگام عضویت توجه داشته باشید که باید یک namespace انتخاب کنید، نامی که برای namespace انتخاب می‌کنید در آدرس سرویس‌های شما به این شکل ظاهر می‌شود: service_name-namespace-name.fandogh.cloud ‌‍

  

## نصب CLI

برای ستفاده از پلتفرم فندق شما می‌توانید یا از داشبورد فندق استفاده کنید یا اینکه CLI فندق را نصب و استفاده کنید.برای استفاده از CLI ‌باید پایتون نسخه ۲ یا ۳ روی سیستم شما نصب باشد.  
اگر پایتون روی سیستم شما نصب باشه به راحتی از طریق pip می‌تونید فندق رو نصب کنید:
```
pip install fandogh_cli --upgrade
```
حالا اگر داخل کامند لاین بنویسید fandogh و اینتر رو بزنید باید این خروجی رو ببینید:
```
$ fandogh
Usage: fandogh [OPTIONS] COMMAND [ARGS]...

Options:
  --version  Show the version and exit.
  --help     Show this message and exit.

Commands:
  domain           Domain management commands
  image            Image management commands
  login            Login to fandogh server
  managed-service  Service management commands
  service          Service management commands
```

در غیر این صورت یعنی توی نصب فندق روی سیستمتون یک جای کار ایراد داره.

## ساخت اولین سرویس
اجازه بدید یک سرویس ساده بسازیم تا بهتر با فندق آشنا بشیم.
یک دایرکتوری بسازید داخلش یک فایل به نام Dockerfile بسازید با این محتویات:
```
FROM nginx:latest
COPY index.html /usr/share/nginx/html/
ENTRYPOINT ["nginx", "-g", "daemon off;"]
```
و یک فایل index.html هم کنارش می‌سازیم:
```
<html>
<body>
	Hello buddy :)
</body>
</html>
```  
حالا کافیه ایمیج بسازیم، منتشر کنیم و سرویس رو اجرا کنیم:
```
$ fandogh login  --username=YOUR_USERNAME --password=YOUR_PASSWORD
Logged in successfully
$ fandogh image init  --name=simple_nginx
Image created successfully
$ fandogh image publish --version v0.1
workspace is ready.
Step 1/3 : FROM nginx:latest
 ---> c82521676580
Step 2/3 : COPY index.html /usr/share/nginx/html/
 ---> 89acd61bde6e
Step 3/3 : ENTRYPOINT nginx -g daemon off;
 ---> Running in 0454d0fabc14
 ---> 9c05b98be468
Successfully built 9c05b98be468
Pushing image to the registry...
Image has been pushed into the registry.
$ fandogh service deploy --version v0.1 --name hello-buddy
Congratulation, Your service is running ^_^
Your service is accessible using the following URLs:
 - http://hello-buddy-YOUR-NAMESPACE.fandogh.cloud
 - https://hello-buddy-YOUR-NAMESPACE.fandogh.cloud

```

# مفاهیم فندق
در این بخش می‌خوایم یک گشتی در قسمت‌های مختلف پلتفرم بزنیم و اجزای مختلف پلتفرم رو یک به یک بررسی کنیم.

## فضانام‌ها
هر Namespace یک فضای مجازی بر روی ابر فندق است. سرویس‌های شما بر روی Namespaceای که خود شما موقع ثبت نام، نام آن را مشخص کرده‌اید اجرا می‌شوند. سرویس‌های یک Namespace از طریق شبکه داخلی می‌توانند به یک‌دیگر دسترسی داشته باشند. 
### شبکه داخلی فضانام‌ها
 هر سرویس درون یک فضانام دارای یک آدرس `IP` و یک `service_name` است.  
برای درک بهتر موضوع به تصویر زیر توجه کنید.

![Fandogh Network](http://blog.fandogh.cloud/articles/service_relation.png "Fandogh Network")

همانگونه که مشاهده می کنید در این Namespace تعداد 4 سرویس ساخته شده است و فندق به هر سرویس ایجاد شده یک IP اختصاص داده است، همینطور هر سرویس دارای مشخصه دیگری به نام `service_name` است.  
مشخصه اصلی برای آنکه سرویس‌ها همدیگر را پیدا کنند و با هم تعامل داشته باشند `service_name` است، زیرا که اگر تحت هر شرایطی یکی از سرویس‌ها Redeploy شود، IP جدیدی به آن تخصیص داده خواهد شد.
برای مثال اگر فرض کنیم سرویس SVC1 با SVC2 در تعامل بوده ولی بعد از مدتی  
نسخه جدیدی از سرویس SVC2 بر روی فندق deploy شده باشد، سرویس SVC1 با پرس و جو از DNS می‌تواند IP جدید سرویس مورد نظر را پیدا کند و به تعامل ادامه دهد. 
### سرویس DNS فضانام‌ها
همانطور که می‌دانیم هر وب‌سایت و یا وب‌‌سرویس در فضای اینترنت دارای یک شناسه با نام IP است، اما از آنجایی که بخاطر سپردن این IP Addressها دشوار است، از سرویسی به نام DNS یا Domain Name System استفاده می‌شود، این سرویس وظیفه ترجمه نام‌ها به IP منتسب شده به آن را بر عهده دارد.
در فندق نیز هر Namespace دارای DNS Server مختص به خود است که وظیفه ترجمه نام سرویس‌ها به IP سرویس را بر عهده دارد.
![Fandogh DNS](http://blog.fandogh.cloud/articles/dns_namespace.png "Fandogh DNS")
### فضای ذخیره‌سازی فضانام‌ها
همانطور که انتظار می‌رود هر سرویس باید بتواند در فضایی مانا اطلاعات خود را ذخیره و بازیابی کند، به همین جهت هر Namepace به همراه یک Persistent Storage یا فضای ذخیره‌سازی مانا  ساخته می‌شود.  
به صورت پیش فرض همه سرویس‌ها به این فضای اطلاعاتی دسترسی دارند و می‌توانند عملیات Read و Write بر روی آن انجام دهند.
![Fandogh Storage](http://blog.fandogh.cloud/articles/shared_storage.png "Fandogh Storage")

## تصاویر
در فندق به هر سرویس یک Image می‌گوییم و شما میتونید هر Image را معادل یک Image در داکر تصور کنید، به ازای هر Image یک یا چند سرویس در فندق اجرا می‌شوند.
### ساخت ایمیج‌ها
هنگامی که شما در CLI دستور init را فراخوانی می‌کنید، سمت سرور فندق یک پروژه جدید با نامی که مشخص کرده‌اید ساخته می‌شود.این پروژه در ابتدا حاوی هیچ ورژنی نیست و فقط یک نام است که بعدا از طریق ورژن‌هایی که برای آن می‌سازید می‌توانید سرویس خود را اجرا کنید.
زمانی که در CLI دستور publish را اجرا می‌کنید، CLI محتویات پوشه جاری را با فرمت zip فشرده می‌کند و به عنوان یک ورژن بخصوص روی سرور فندق بارگذاری می‌کند. فایل فشرده سمت سرور فندق گشوده می‌شود و با استفاده از Dockerfile همراه فایل‌ها یک ایمیج داکر تولید شده و با ورژن مشخص شده تگ می‌خورد و در کتابخانه فندق ذخیره یا Push می‌شود.
هنگام ساخته شدن Docker image از روی محتویات فایل فشرده، لاگ ساخت ایمیج تولید می‌شود. این لاگ بلافاصله بعد از publish موفق روی ترمینال شما قابل مشاهده خواهد بود، مگه آنکه از طریق d- یا detach به CLI گفته باشید که نیازی به مشاهده لاگ ندارید.
هر زمان که نیاز داشته باشید می‌توانید از طریق fandogh image logs لاگ‌های مربوط به ساخت یک ورژن بخصوص را مشاهده کنید.
### مدیریت تصاویر
دستورات دیگری که از طریق CLI برای مدیریت image ها در اختیار دارید به شرح زیر است:
* versions
دستوری برای مشاهده لیست ورژن‌های یک ایمیج بخصوص
* list
دستوری برای مشاهده لیست تمام image هایی که تا به حال ساخته‌اید
* delete
دستوری برای حذف کردن یک image که قبلا ساخته‌اید، توجه داشته باشید که حذف image منجر به حذف تمام ورژن‌ها و لاگ‌های بیلد خواهد شد.
## سرویس‌ها
هر سرویس در فندق یک نسخه در حال اجرا از یک ورژن بخصوص از یکی از image های شماست. سرویس‌های در حال اجرای شما همواره از طریق fandogh service list قابل مشاهده است و می‌توانید هر زمان مایل بودید از طریق دستور fandogh service destroy آنها را حذف کنید.
### ساخت سرویس‌ها
برای ساخت سرویس‌ها شما نیاز دارید از دستور fandogh service deploy استفاده کنید، با انتخاب یک ایمیج بخصوص و یک ورژن بخصوص از‌ آن تصویر و انتخاب یک نام برای سرویس، سرویس شما ساخته خواهد شد.
نامی که برای سرویس انتخاب می‌کنید همان نامی است که بعدا به شما کمک می‌کند در شبکه خصوصی فضانام آن سرویس را پیدا کنید، به علاوه برای سرویس‌هایی که  internal-- نیستند یک hostname به شکل زیر نیز در نظر گرفته می‌شود که می‌توانید از طریق آن به سرویس خود دسترسی پیدا کنید.
`ServiceName-Namespace.fandogh.cloud`
فقط لطفا توجه کنید که چون نام service قرار است به عنوان بخشی از Hostname استفاده شود  این مجدودیت‌ها را لازم است رعایت کنید:
-   فقط می‌تواند شامل حروف کوچک، اعداد و خط تیره باشد.
-   نمی‌تواند با اعداد آغاز شود.
-   نمی‌تواند با خط تیره آغاز یا پایان یابد.
-   نمی‌تواند حاوی دو خط تیره متوالی باشد.

#### پارامتر‌های ساخت سرویس
ساخت سرویس پارامتر‌های زیادی دارد که می‌توانید هنگام ساخت استفاده کنید:

* **--env** یا **-e**  
از طریق این پارامتر مشخص می‌کنید می‌توانید environment variable های مختلف مورد نیاز سرویس برای اجرا را مشخص کنید.توجه داشته باشید که هیچ محدودیتی در تعداد `--env` وجود ندارد .به عنوان مثال فرض کنید سرویس برای کار به پارامتر‌های api_token و secret_key نیاز دارد، در این صورت از این طریق پارامتر‌ها را مشخص می‌کنید:
```
fandogh service deploy --env api_token="some token" --env api_secret_key="some secret key"
```
* **--port** یا **-p**  
از طریق این پارامتر مشخص می‌کنید می‌توانید کدام یک از پورت‌های سرویس مورد نظر خود را می‌خواهید در دسترس قرار دهید.در صورت عدم مشخص کردن پورت بخصوصی، پورت 80 در دسترس قرار می‌گیرد.
مثلا فرض کنید می‌خواهیم به جای 80 از پورت 8080 استفاده کنیم:
```
fandogh service deploy --port 8080
```
* **--internal**  
در حالت عادی پورت مورد نظر هر سرویس به صورت public قابل دسترس است، با اضافه کردن سویچ `--internal‍` می‌توانید پورت مورد نظر را فقط در شبکه داخلی خودتان قابل دسترس نگهدارید.
```
fandogh service deploy --internal
```
* **--hosts** یا **-h** 
از طریق این سویچ می‌توانید از بین دامنه‌هایی که قبلا ثبت و تایید کرده‌اید یک یا چند موررد را انتخاب کنید که به این سرویس متصل شوند، می‌توانید بیش از یکبار این سویچ را استفاده کنید مثلا:
```
fandogh service deploy -h site.com -h www.site.com
```
**دقت داشته باشید باید از طریق CNAME دامنه مورد نظر به آدرس‌های این سرویس متصل شده باشد.**

## سرویس‌های مدیریت شده
خیلی از سرویس‌ها هستند که توسط اکثرا کاربران فندق به طور مداوم استفاده می‌شوند، به عنوان مثال MySQL یا PostgreSQL ، برای ساده‌تر کردن راه‌اندازی این سرویس‌ها ما در فندق managed-service را طراحی کردیم که به کمک آن می‌توانید به سرعت سرویس مورد نظر را راه‌اندازی کنید.
برای اینکار کافیست ابتدا لاگین کنید سپس لیست سرویس‌های آماده را از طریق `fandogh managed-service help` مشاهده کنید.
هر managed-service حاوی مجموعه‌ای است از پارامتر‌های قابل تنظیم که می‌توانید از طریق سویچ -c  مشخص کنید، به عنوان مثال برای دیپلوی کردن یک MySQL می‌توانیم به این شکل یک سرویس بسازیم:
```
fandogh managed-service deploy mysql 9.1 -c service_name=mydatabase -c mysql_root_password=12341234
```
این دستور یک سرویس MySQL ایجاد می‌کند که نام سرویسش mydatabase است( یعنی در شبکه داخلی فضانام شما باقی سرویس‌ها از طریق نام mydatabase می‌توانند به آن متصل شوند) و رمز عبور root آن 12341234 است.

## دامنه‌ها
با اینکه فندق به طور پیشفرض به سرویس‌های غیرinternal شما یک Hostname مثل serviceName.NameSpace.fandogh.cloud اختصاص می‌دهد، شاید شما مایل باشید یک hostname اختصاصی از روی domain خودتان بسازید و از طریق آن به سرویس خود دسترسی پیدا کنید.
به عنوان مثال بخواهید api.some-project.com را به سرویس api خود متصل کنید، یا اینکه some-project.com که صفحه اصلی شماست را به سرویسی به نام front-web متصل کنید.
برای اینکار ما نیاز داریم ابتدا مطمئن شویم که شما مالک دامنه هستید، بعد از این کار شما می‌توانید از دامنه به راحتی برای سرویس‌های خود استفاده کنید.
### افزودن و احراز مالکیت دامنه
پروسه اثبات مالکیت بسیار ساده است، ما یک key در اختیار شما قرار میدهیم و شما باید آن key را در قالب یک TXT record در NS خود ست کنید، ما رکورد را بررسی می‌کنیم اگر وجود داشته باشد یعنی شما مالک دامنه هستید.
البته اگر قبلا مثلا مالکیت خود را روی example.com اثبات کرده باشید دیگری برای افزودن sub.example.com نیازی به تایید ندارید.
برای افزودن دامنه ابتدا fandogh domain add را اجرا کنید، نام دامنه را بنویسید و سپس keyای که در اختیار شما قرار داده می‌شود را به عنوان TXT record ایجاد کنید و entry (یا return) را فشار دهید.
اگر رکورد به درستی ست شده باشد دامنه روی حساب کاربری شما فعال می‌شود و می‌توانید هنگام ساخت سرویس آن را با -h استفاده کنید.

  

# تغییرات (Change log)
